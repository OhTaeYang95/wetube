"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var ALLOWED_TOKENS = new Set(["no-referrer", "no-referrer-when-downgrade", "same-origin", "origin", "strict-origin", "origin-when-cross-origin", "strict-origin-when-cross-origin", "unsafe-url", ""]);

function getHeaderValueFromOptions(_ref) {
  var _ref$policy = _ref.policy,
      policy = _ref$policy === void 0 ? ["no-referrer"] : _ref$policy;
  var tokens = typeof policy === "string" ? [policy] : policy;

  if (tokens.length === 0) {
    throw new Error("Referrer-Policy received no policy tokens");
  }

  var tokensSeen = new Set();
  tokens.forEach(function (token) {
    if (!ALLOWED_TOKENS.has(token)) {
      throw new Error("Referrer-Policy received an unexpected policy token ".concat(JSON.stringify(token)));
    } else if (tokensSeen.has(token)) {
      throw new Error("Referrer-Policy received a duplicate policy token ".concat(JSON.stringify(token)));
    }

    tokensSeen.add(token);
  });
  return tokens.join(",");
}

function referrerPolicy() {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var headerValue = getHeaderValueFromOptions(options);
  return function referrerPolicyMiddleware(_req, res, next) {
    res.setHeader("Referrer-Policy", headerValue);
    next();
  };
}

module.exports = referrerPolicy;
exports["default"] = referrerPolicy;